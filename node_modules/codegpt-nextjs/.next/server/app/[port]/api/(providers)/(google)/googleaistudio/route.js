"use strict";(()=>{var e={};e.id=6267,e.ids=[6267],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},76224:e=>{e.exports=require("tty")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},81411:(e,t,o)=>{o.r(t),o.d(t,{originalPathname:()=>T,patchFetch:()=>A,requestAsyncStorage:()=>q,routeModule:()=>v,serverHooks:()=>k,staticGenerationAsyncStorage:()=>P});var r={};o.r(r),o.d(r,{HEAD:()=>y,POST:()=>x});var a=o(49303),n=o(88716),s=o(60670),i=o(20021),l=o(56342),p=o(76129),u=o(51414),d=o(87320),c=o(94750),g=o(73626),m=o(16292),h=o(1094);async function y(){return Response.json("",{status:i.Xd?.apiKey?200:401})}async function x(e){if(i.Xd?.config?.apiKey?.toLowerCase()!=="google ai studio")return Response.json("Oops! The selected model has a potential configuration conflict. Please ensure that all your open instances of VSCode have the same provider.",{status:400});let{messages:t}=await e.json();t=(0,g.D)({messages:t});let o=e.headers.get("model"),r=e.headers.get("promptType"),a=await c.Z.getLanguage(),n=await c.Z.getIdeLanguage(),s="Chat";if(r){s=t[t.length-1].content+"CodeGPT";let e=(0,p.u)({promptType:t[t.length-1].content,cleanPromptText:await c.Z.getSelectedText(),language:n});e&&(t[t.length-1].content=e)}let l=o.includes("bison");l&&t.unshift({role:"system",content:"I am a helpful programming expert assistant. If you ask me a question that is rooted in truth, I will give you the answer in markdown. Follow the user's instructions with precision and attention to detail. Provide the code in a single block. Minimize any additional text."});let u=await c.Z.getSelectedText();u&&(t[t.length-1].content+="\n```"+a+"\n"+u+"\n```");let h=(0,d.q)(t.map(e=>e.content).join(""));try{let e=l?await f({messages:t,selectedCode:u,language:a,model:o,promptType:s,promptTokens:h}):await w({messages:t,selectedCode:u,language:a,model:o,promptType:s,promptTokens:h});return new m.wn(e)}catch(e){return Response.json({message:e.message,status:e.status??500},{status:e.status??500})}}let f=async({messages:e,selectedCode:t,language:o,model:r,promptType:a,promptTokens:n})=>{let s={prompt:{context:"I am a helpful programming expert assistant. If you ask me a question that is rooted in truth, I will give you the answer in markdown",examples:[{input:{content:"What is an API?"},output:{content:"An API is a set of rules for interacting with software or a service."}}],messages:e.map(e=>({content:e.content}))},candidate_count:1};if(!i.Xd.apiKey){let e=Error("You need to set your Google details first.");throw e.status=401,e}let p=await fetch(`https://generativelanguage.googleapis.com/v1beta3/models/${r??"gemini-pro"}:generateMessage?key=${i.Xd?.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!p.ok){let e=await p.text();if(e.includes("API key not valid. Please pass a valid API key"))throw Error("Your API key is not valid. Please pass a valid API key");throw Error(e)}let c=await p.json(),g=async e=>{let t=(0,d.q)(e);(0,l.q)({eventName:a,provider:"googleAIStudio",model:r??"gemini-pro",promptTokens:n,completionTokens:t,totalTokens:n+t,statusCode:p.status})};if(t){let e="```"+o+"\n"+t+"\n```"+c?.candidates?.[0].content;return await (0,u.Y)(e,{onFinal:g})}return await (0,u.Y)(c?.candidates?.[0].content,{onFinal:g})},w=async({messages:e,selectedCode:t,language:o,model:r,promptType:a,promptTokens:n})=>{"user"!==e[0].role&&(e=e.slice(1));let s=i.Xd?.globalState?.config,p={contents:e.map(e=>({role:e.role.replace("system","model").replace("assistant","model").toUpperCase(),parts:{text:e.content}})),safety_settings:{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_NONE"},generation_config:{temperature:s?.temperature||.3,maxOutputTokens:s?.maxTokens||1500,candidateCount:1}};if(!i.Xd.apiKey){let e=Error("You need to set your Google details first.");throw e.status=401,e}let c=`https://generativelanguage.googleapis.com/v1beta/models/${r}:streamGenerateContent?key=${i.Xd?.apiKey}`,g=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)});if(!g.ok){let e=await g.text();if(e.includes("API key not valid. Please pass a valid API key"))throw Error("Your API key is not valid. Please pass a valid API key");throw Error(e)}let m=await (0,h.O)(g,{onFinal:async e=>{let t=(0,d.q)(e);(0,l.q)({eventName:a,provider:"googleAIStudio",model:r,promptTokens:n,completionTokens:t,totalTokens:n+t,statusCode:g.status})}}),y=e.slice(0,-1).some(e=>e.content.includes(t));return t&&(a||!y)?await (0,u.V)(["```"+o+"\n"+t+"\n```"],m):m},v=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/[port]/api/(providers)/(google)/googleaistudio/route",pathname:"/[port]/api/googleaistudio",filename:"route",bundlePath:"app/[port]/api/(providers)/(google)/googleaistudio/route"},resolvedPagePath:"/Users/maol/WebstormProjects/Trabajo/codegpt-nextjs/app/[port]/api/(providers)/(google)/googleaistudio/route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:q,staticGenerationAsyncStorage:P,serverHooks:k}=v,T="/[port]/api/(providers)/(google)/googleaistudio/route";function A(){return(0,s.patchFetch)({serverHooks:k,staticGenerationAsyncStorage:P})}},1094:(e,t,o)=>{o.d(t,{O:()=>r});async function r(e,t){let o=e.body?.getReader();if(!o)throw Error("No reader available");return new ReadableStream({async start(e){let r=new TextDecoder("utf-8"),a="";t?.onStart?.();let n="";for(;;){let{done:i,value:l}=await o.read();if(i){s(),t?.onFinal?.(a),t?.onCompletion?.(a),e.close();return}let p=r.decode(l);n+=p,s()}function s(){let o;let r=/"text":\s*"((\\"|[^"])*)"/g;for(;null!==(o=r.exec(n));){let r=function(e){try{return JSON.parse(`"${e}"`)}catch(t){return console.error("Error unescaping string",e),e}}(o[1]);e.enqueue(r),t?.onToken?.(r),a+=r,n=n.slice(o.index+o[0].length)}}},cancel(){o.releaseLock()}})}},87320:(e,t,o)=>{o.d(t,{q:()=>a});var r=o(72223);let a=(e,t)=>(0,r.b9)(t??"gpt-4").encode(e).length??0}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),r=t.X(0,[9276,1203,50,3306,6292,2223,464],()=>o(81411));module.exports=r})();